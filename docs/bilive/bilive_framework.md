# biLive跨平台应用框架

**biLive跨平台应用框架**（以下简称**biLive框架**）是武汉百利孚信息科技有限公司推出的一个桌面程序应用框架，用于开发跨平台带图形界面的桌面应用程序。

biLive框架发布的应用程序为PFF／PFP格式，具有一次开发、多平台免编译无差别高效运行的特点。

开发者只需要一次编码、一次打包，发布的PFF格式的文件就可以在多种操作系统、多种ＣＰＵ架构的目标机器上运行。前提是在目标机器上已经安装了支持PFF运行时引擎的运行时环境。运行时环境可以是百利孚官方发布的biReader、智应软件中心，也可以是如智龙ＩＤＥ等使用PFF运行时引擎做为插件框架的应用程序。

biLive框架目前发布的版本支持Windows7/8/10及多个Linux发行版，支持x86_64/AMD64、ＡＲＭ64、mips64el、loongarch64、申威等ＣＰＵ架构类型。技术上也可支持macOS，但目前尚未发布相应版本。

biLive框架有自己独特的设计和架构，目标是为开发者提供一个易于将所开发的程序在复杂多样的终端用户处进行组装和集成的应用开发框架，为最终用户提供具有更强的灵活性、更高的协同性、更具集成性、有更强的可扩展性，为所有使用同一技术框架的用户提供一个更具统一性和整体性的软件平台。

## 一、biLive框架整体架构

![example](bilive_framework.png)

### １）PFF运行时引擎
PFF运行时引擎负责PFF程序的加载、界面渲染、脚本运行、缓存、销毁、多实例管理、多视图、与其它PFF交互和集成、升级等，为PFF程序的运行提供底层支撑。

### 2）数据库引擎
PFF运行时后台需要数据库，目前可以使用SQLite、MSSQL Server、PostgreSQL、Sybase等，未来也会支持更多种数据库管理系统。数据库引擎对数据库连接、数据表的创建、数据的增删改查等数据库操作都进行了封装，开发者只需要很少的代码即可快速进行与数据库相关的开发。

### 3）分布式引擎
这部分包括分布式数据、分布式事务处理、分布式工作流引擎等。以便将来PFF可在分布式网络环境下运行和通信。这部分还在升级中，目前发布的产品尚未提供这部分功能。

### 4）上下文环境管理
不同PFF有不同的运行时上下文环境，同一PFF也可以有多个实例，因此在运行时需要相互隔离。不同的运行时环境，其所用的Python也需要互相隔离。

### 5）日志管理
运行时环境提供统一的运行日志。

### 6）用户/权限管理
用于多用户环境下，用户账号管理、登录管理、权限管理等。

### 7）打印和输出
biLive框架提供通用的打印、打印预览、多种格式文件输出、数据导入导出等功能。

### 8）辅助工具
提供一些通用的辅助工具，比如程序界面截图、数据记录的收藏等。

### 9）扩展库管理
对Python第三方库进行管理。这部分目前在规划中，目前发布的版本尚未提供这部分功能。

### 10）基础库

这部分包括：
- Qt5和Python3绑定
- biLive标准控件
- 公用基础库
- PFF运行时接口
- 数据库访问接口

biLive框架对Qt5的基础库进行了封装、并与Python3进行绑定，以便可以通过Python3语句访问和调用这些库。

在Qt5的控件基础上，封装了一批biLive标准控件用于界面的可视化快速开发，并对应开放了ＡＰＩ接口。

同时提供了一些通用的公用函数、公用变量、运行日志、数据库访问、用户管理、系统参数、PFF运行时等的API接口。

这些基础库与Qt5、Python3、Python第三方库共同为biLive应用框架提供系统级的基础支持。

### 11）Qt5基础库

biLive框架对Qt5几个主要的库进行了封装，提供了Python脚本访问的接口，并在底层进行Python数据和对象与Qt数据和对象之间的转换。

已经封装的库包括：
- QtCore
- QtGui
- QtMultimedia
- QtNetwork
- QtOpenGL
- QtSql
- QtSvg
- QtUiTools
- QtXml
- QtXmlPatterns
- QtWidgets
- QtSerialPort
- Qt namespace

### 12）Python3基础库及第三方库

biLive框架使用Python3做为编程语言。因此也可以使用大量基于Python3的第三方库。用户也可以自己进行扩展。

## 二、开发工具和运行时环境

百利孚已经开发出多个软件产品，为开发者提供开发调试工具，以及为最终用户提供运行时环境：

### 1）biForm集成式开发环境

biLive框架规范了PFF的标准结构和编程接口，并为此提供了集成式开发环境biForm。开发者使用biForm开发PFF自然具备其天然特性，用户并不需要了解其底层运作原理。

PFF程序使用Python３做为编程语言。biForm用Qt5和Python3开发，为PFF程序提供了集成式开发环境，集成了可视化界面设计器、数据视图设计器、Python脚本编辑器、试运行、调试、打包发布等开发者需要的所有功能。

PFF程序既可以使用Qt5提供的丰富的控件库和底层库，也可以使用众多数量庞大、功能强大的Python第三方库。

### 2）biReader通用运行时环境
biReader是一个允许以多实例方式运行的通用的运行时环境。每个实例为使用这一实例的所有PFF提供一个统一的多文档主窗口环境。不同实例之间的PFF的运行是互相隔离的，也即同一实例中的PFF直接通过PFF运行时引擎进行集成，但与其它实例中的PFF是不能直接通过PFF运行时引擎进行集成的。

PFF在biReader中是即插即用的，用户随时可以对某个PFF进行升级，或添加新的PFF对原有功能进行扩展。

biReader可使用多种ＤＢＭＳ做为后台数据库，多个终端用户可以通过使用同一个数据源共享数据、同步升级、权限管理等。所以它适合为ＥＲＰ／ＣＲＭ／ＨＲ等管理信息系统提供独立的运行环境。

一个biReader实例可使用多个数据源并在它们之间进行切换，适合用户需要并行使用多个系统的场合。

因为它支持多实例，所以也适合用于为测试和调试PFF程序提供独立的互相隔离的运行环境。

### 3） 智应软件中心

智应软件中心是一个单实例的通用的运行时环境。与biReader最大的不同是，每个PFF以独立的窗口运行。并且智应后台目前只能使用SQLite数据库，暂时不能使用其它数据库。

在ＰＣ端只需要安装智应软件中心，即可双击启动运行PFF／PFP文件。智应软件中心为这些PFF提供统一的运行时环境和管理工具。

## 三、PFF/PFP程序的发布

PFF/PFP程序，视其功能和应用场合，可以通过以下形式发布：

### １）做为独立的应用程序发布

这种情况下，目标机器上需要安装智应软件中心。

用户双击PFF程序，或通过智应软件中心提供的菜单选择PFF文件，即可运行。首次运行后，PFF文件就可以删除掉了，以后直接通过智应软件中心的菜单就可以调用。当然，仍旧双击PFF文件，也是一样可以正常运行的。

多个PFF程序可以打包成一个PFP程序，一起发布，运行效果和单个运行其中的每个PFF是一样的。

### ２）做为一个功能模块发布

这种情况一般是在biReader中运行，PFF做为一个大的系统的某个子功能模块而存在。比如销售管理系统中，”销售订单“就可以是一个PFF程序，”出库申请单“就可以是另一个PFF程序。用户第一次使用某个PFF时，通过biReader提供的菜单打开PFF文件，就可以运行。首次运行后，PFF文件可以删除掉，以后通过biReader提供的菜单或其它PFF中的引导，就可以调用它。

这种场合也可以使用PFP文件将一组PFF一起进行发布。

这种场合下使用的PFF与第一种做为独立应用程序发布的PFF是可以互相通用的。但有些PFF程序如果必须使用特定的数据库类型，比如必须使用MSSQL Server，目前就只有biReader支持这种ＤＢＭＳ，虽然将其做为独立的应用程序发布，程序是可以执行的，但也不是用户想要的结果。

用户如有特殊需要，可以对biReader进行定制，比如修改启动画面、修改软件名称、修改主窗口标题等，目前只有百利孚官方提供这些定制服务。定制后的biReader可以做为独立的自用软件或商用软件发布。

### ３）做为插件发布

除了biReader和智应软件中心，百利孚以及合作伙伴也会使用biLive框架开发一些其它应用程序。已经面市的有为龙芯嵌入式开发提供集成式开发环境的智龙IDE。

智龙IDE底层使用了biLive框架做为其插件框架，插件也是使用PFF格式。

做为插件开发的PFF程序，通常需要调用其主体应用程序的开发接口。所以一般这类插件在智应软件中心和在biReader中虽然可以运行，但可能会报错，或无法得到正常的运行结果，除非这个插件没有使用主体应用程序特定的开发接口，或在程序中做了通用化的环境容错处理。

